<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>AI Mood Player</title>
		<link rel="stylesheet" href="./styles.css" />
		<meta name="description" content="얼굴 표정 감정 분석으로 맞춤 음악을 재생하는 AI Mood Player" />
	</head>
	<body>
		<canvas id="starfield"></canvas>
		<!-- Top Navigation -->
		<header class="navbar">
			<div class="nav-left">
				<div class="logo">🎵</div>
				<div class="brand">
					<div class="title">AI Mood Player</div>
					<div class="caption">당신의 감정을 음악으로</div>
				</div>
				<nav class="menu">
					<a href="#features">기능</a>
					<a href="#how">작동 방식</a>
					<a href="./community.html">커뮤니티</a>
				</nav>
			</div>
			<div class="nav-right">
				<button id="auth-open" class="btn btn-primary-glow">로그인/회원가입</button>
				<button id="profile-btn" class="btn btn-tertiary" style="display:none">프로필</button>
				<button id="app-logout" class="btn" style="display:none">로그아웃</button>
				<button id="spotify-login" class="btn btn-secondary">Spotify 로그인</button>
				<button id="spotify-logout" class="btn btn-tertiary">Spotify 로그아웃</button>
			</div>
		</header>

		<!-- App Content Wrapper (hidden until auth) -->
		<div id="app-content">
		<!-- Hero -->
		<section class="hero">
			<h1>당신의 감정이 완벽한 플레이리스트를 만듭니다</h1>	
			<p class="hero-sub">AI가 얼굴 표정을 분석하고 지금 이 순간에 딱 맞는 음악을 자동으로 추천해 드립니다.</p>
			<div class="cta-row">
				<button id="cta-upload" class="btn btn-primary-glow">사진 업로드</button>
				<button id="cta-webcam" class="btn btn-ghost">웹캠 사용</button>
			</div>
			<div class="features" id="features">
				<div class="feature-card">
					<div class="icon">⚡</div>
					<div class="title">실시간 분석</div>
					<div class="desc">웹캠으로 실시간 감정 분석</div>
				</div>
				<div class="feature-card">
					<div class="icon">🎵</div>
					<div class="title">Spotify 연동</div>
					<div class="desc">수백만 곡 중 완벽 매칭</div>
				</div>
				<div class="feature-card">
					<div class="icon">💙</div>
					<div class="title">맞춤형 학습</div>
					<div class="desc">취향을 학습하는 추천</div>
				</div>
			</div>
		</section>

		<!-- Main Panels -->
		<main class="main container">
			<div class="main-grid">
				<!-- Left: Analysis Panel with tabs -->
				<section class="card panel">
					<div class="panel-header">
						<div class="segmented">
							<button id="tab-upload" class="seg active">사진 업로드</button>
							<button id="tab-webcam" class="seg">웹캠 사용</button>
						</div>
					</div>

					<!-- Upload Panel -->
					<div class="panel-body panel-upload">
						<div id="dropzone" class="dropzone">
							<div class="drop-icon">⬆</div>
							<div class="drop-title">사진을 여기에 드롭하세요</div>
							<div class="drop-sub">또는 클릭하여 파일을 선택하세요 (JPG, PNG, GIF)</div>
							<input type="file" id="image-input" accept="image/*" hidden />
						</div>
						<div id="preview" class="preview hidden">
							<img id="preview-img" alt="미리보기" />
						</div>
						<div class="row">
							<button id="analyze-btn" class="btn primary">감정 분석하기 (사진)</button>
							<button id="demo-btn" class="btn">데모 모드</button>
						</div>
						<div class="tips">
							<div class="tips-title">더 정확한 분석을 위한 팁</div>
							<ul>
								<li>얼굴이 정면으로 잘 보이는 사진을 사용하세요</li>
								<li>밝은 조명에서 촬영하면 더 정확합니다</li>
								<li>안경이나 마스크는 벗는 것이 좋아요</li>
							</ul>
						</div>
						<p id="status" class="status"></p>
					</div>

					<!-- Webcam Panel -->
					<div class="panel-body panel-webcam hidden">
						<div class="cam-wrapper">
							<video id="cam" autoplay playsinline muted></video>
							<canvas id="overlay"></canvas>
						</div>
						<div class="row">
							<button id="start-cam" class="btn primary">웹캠 시작</button>
							<button id="stop-cam" class="btn">중지</button>
						</div>
						<p class="hint">on-device 모델(face-api.js)로 네트워크 지연 없이 실시간 분석합니다.</p>
					</div>
				</section>

				<!-- Right: Recommendation / Results -->
				<section class="card panel" id="panel-reco">
					<div class="panel-title">음악 추천</div>
					<div class="result-box hidden" id="result-box">
						<div class="result-line"><span class="label">감정:</span> <span id="emotion-text">-</span></div>
						<div class="result-line"><span class="label">무드:</span> <span id="mood-text">-</span></div>
						<div class="result-line"><span class="label">신뢰도:</span> <span id="confidence-text">-</span></div>
					</div>
					<div id="embed" class="embed placeholder">
						<div class="placeholder-inner">
							<div class="big-icon">∃</div>
							<div class="ph-title">음악 추천을 기다리는 중</div>
							<div class="ph-desc">사진을 업로드하거나 웹캠으로 촬영하면 당신의 감정에 맞는 플레이리스트를 추천해드립니다.</div>
						</div>
					</div>
					<div class="row">
						<button id="play-on-spotify" class="btn btn-secondary">내 Spotify 기기에서 재생 시도</button>
						<button id="like" class="btn">좋아요</button>
						<button id="skip" class="btn">다른 추천 보기</button>
						<button id="reset-learning" class="btn btn-tertiary">학습 초기화</button>
					</div>
					<p class="hint">브라우저 정책상 자동 재생이 제한될 수 있습니다. 재생 버튼을 눌러주세요.</p>
				</section>
			</div>
		</main>

		<!-- How it works / Info -->
		<section id="how" class="how container">
			<div class="how-header">간단한 3단계</div>
			<div class="how-grid">
				<div class="how-card">
					<div class="icon">📷</div>
					<div class="title">사진 업로드</div>
					<div class="desc">사진을 업로드하거나 웹캠으로 촬영하세요</div>
				</div>
				<div class="how-card">
					<div class="icon">🤖</div>
					<div class="title">AI 감정 분석</div>
					<div class="desc">표정을 분석해 현재 상태를 파악합니다</div>
				</div>
				<div class="how-card">
					<div class="icon">🎧</div>
					<div class="title">맞춤 음악 추천</div>
					<div class="desc">무드에 맞는 플레이리스트를 재생합니다</div>
				</div>
			</div>

			<div class="system-grid">
				<div class="sys-card"><div class="icon">💙</div><div class="title">취향 학습</div><div class="desc">좋아요/스킵으로 취향을 학습합니다</div></div>
				<div class="sys-card"><div class="icon">📒</div><div class="title">감정 기록</div><div class="desc">시간대별 감정을 바탕으로 추천 향상</div></div>
				<div class="sys-card"><div class="icon">⚡</div><div class="title">실시간 분석</div><div class="desc">순간순간 변하는 감정을 즉시 반영</div></div>
				<div class="sys-card"><div class="icon">🎵</div><div class="title">Spotify 연동</div><div class="desc">내 기기에서 바로 재생</div></div>
			</div>

			<div class="api-note card">
				<div class="api-title">API 연동 안내</div>
				<ul>
					<li><b>Spotify Web API:</b> 실제 곡 재생 및 선택형 미디어제어</li>
					<li><b>Emotion Detection API:</b> 사진 분석 시 감정 분류(Face++)</li>
					<li><b>face-api.js:</b> 브라우저 on-device 실시간 분석</li>
				</ul>
			</div>
		</section>

		<footer class="footer">
			<p>Built with Spotify Embed & Web API, Face++ API (optional), face-api.js. 이 데모는 교육/개발 용도입니다.</p>
		</footer>
		<!-- Community entry card instead of embedded frames -->
		<section class="container" id="community-entry">
			<div class="card" style="padding: 20px; display: grid; gap: 10px; justify-items: center;">
				<h2 class="section-title">Mood Community</h2>
				<p class="section-sub">감정과 음악을 공유하는 전용 커뮤니티 페이지로 이동하세요.</p>
				<a class="btn btn-primary-glow" href="./community.html" aria-label="커뮤니티로 이동">커뮤니티 바로가기</a>
			</div>
		</section>

		<!-- Terms Modal (optional detail) -->
		<div id="terms-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="terms-title">
			<div class="terms-card card" role="document">
				<div class="auth-head">
					<div>
						<div id="terms-title" class="auth-title">자세히 보기</div>
						<div class="auth-sub">약관/정책 전문</div>
					</div>
					<button id="terms-close" class="icon-btn" aria-label="닫기">✕</button>
				</div>
				<div class="terms-body" id="terms-body">
					<p class="muted">샘플 텍스트입니다. 실제 서비스 적용 시 약관/개인정보 처리방침 전문을 삽입하세요.</p>
				</div>
			</div>
		</div>

		<!-- Profile Modal -->
		<div id="profile-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="profile-title">
			<div class="auth-card card mypage-modal" role="document">
				<div class="auth-head">
					<div>
						<div id="profile-title" class="auth-title">마이페이지</div>
						<div class="auth-sub">프로필 · 설정 · 활동 기록</div>
					</div>
					<button id="profile-close" class="icon-btn" aria-label="닫기">✕</button>
				</div>
				<div class="auth-body mypage-body">
					<div class="account-grid">
						<!-- Profile Card -->
						<div class="card acc-card profile-card">
							<div class="profile-top">
								<div class="avatar" id="my-avatar">🙂</div>
								<div class="profile-basic">
									<div class="profile-name" id="my-name">-</div>
									<div class="profile-email" id="my-email">-</div>
								</div>
							</div>
							<div class="profile-actions">
								<button class="btn btn-ghost" id="edit-account">계정 정보 수정</button>
								<button class="btn btn-ghost" id="change-pass">비밀번호 변경</button>
								<button class="btn btn-tertiary" id="profile-logout">로그아웃</button>
							</div>
						</div>

						<!-- Settings / Logging Module -->
						<div class="card acc-card settings-card">
							<h3>설정</h3>
							<label class="toggle-row">
								<input type="checkbox" id="activity-log-toggle" />
								<span>사용 기록 저장 활성화</span>
							</label>
							<div class="hint small muted">활성화하면 Mood 선택, 재생된 음악, 좋아요/스킵 등이 기록됩니다.</div>
							<button class="btn btn-ghost" id="open-theme-settings">테마 설정</button>
						</div>

						<!-- Activity Hint Module -->
						<div class="card acc-card info-card">
							<h3>기록 안내</h3>
							<p class="muted">활동 기록을 저장하여 과거 감정과 음악 취향을 돌아볼 수 있습니다.</p>
							<ul class="mini-list">
								<li>무드 감정 분석 결과</li>
								<li>재생한 플레이리스트</li>
								<li>좋아요/스킵 동작</li>
							</ul>
						</div>

						<!-- Activity History -->
						<div class="card acc-card history-card">
							<div class="hist-head">
								<h3>활동 기록</h3>
								<div class="filters segmented" id="history-filters">
									<button class="seg active" data-filter="all">전체</button>
									<button class="seg" data-filter="mood">무드</button>
									<button class="seg" data-filter="play">음악 재생</button>
									<button class="seg" data-filter="pref">좋아요/스킵</button>
								</div>
							</div>
							<div id="history-empty" class="empty muted hidden">아직 기록이 없습니다.</div>
							<ul id="history-list" class="history-list"></ul>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Community Extension Frames -->
		<section id="community" class="community container">
			<aside class="community-sidebar" id="community-sidebar">
				<div class="side-brand">
					<div class="side-title">Mood Player</div>
					<div class="side-sub">Community</div>
				</div>
				<nav class="side-nav" id="side-nav">
					<button class="side-item active" data-view="feed">🏠 <span>홈</span></button>
					<button class="side-item" data-view="notifications">🔔 <span>알림</span><span class="badge-count" id="notif-badge" style="display:none"></span></button>
					<button class="side-item" data-view="profile">👤 <span>프로필</span></button>
					<button class="side-item" data-view="theme">⚙ <span>설정</span></button>
				</nav>
				<div class="side-bottom">
					<button id="open-share" class="btn btn-primary-glow side-share-btn">+ 새 무드 공유</button>
				</div>
			</aside>
			<div class="community-main">
				<h2 class="section-title">Mood Community</h2>
				<p class="section-sub">공유된 감정과 음악을 탐색해보세요</p>
				<!-- Feed Frame -->
				<div class="frame frame-feed active" id="frame-feed">
					<div class="feed-filters chip-row" id="feed-filter-chips">
						<button class="chip active" data-filter="all">전체</button>
						<button class="chip" data-filter="mine">내 무드</button>
						<button class="chip" data-filter="follow">팔로잉</button>
						<button class="chip" data-filter="trend">인기</button>
					</div>
					<div class="feed-column" id="feed-grid"></div>
				</div>
				<!-- Share Creator Frame -->
			<div class="frame frame-share" id="frame-share">
				<div class="share-layout">
					<div class="creator-panel card">
						<h3>오늘의 무드 공유</h3>
						<div class="mood-buttons" id="mood-buttons">
							<button class="mood-btn" data-mood="Chill">Chill</button>
							<button class="mood-btn" data-mood="Focus">Focus</button>
							<button class="mood-btn" data-mood="Happy">Happy</button>
							<button class="mood-btn" data-mood="Sad">Sad</button>
							<button class="mood-btn" data-mood="Angry">Angry</button>
							<button class="mood-btn" data-mood="Chill">Chill</button>
						</div>
						<textarea id="mood-comment" placeholder="오늘의 기분/상황을 적어보세요" rows="4"></textarea>
						<input type="text" id="current-track" placeholder="현재 듣는 곡 또는 플레이리스트" />
						<button id="share-submit" class="btn btn-primary-glow" disabled>공유하기</button>
					</div>
					<div class="preview-panel card" id="share-preview">
						<h3>공유 카드 미리보기</h3>
						<div class="preview-card-inner">
							<div class="p-header"><span class="p-avatar">🎧</span><span class="p-nick" id="preview-nick">User</span><span class="p-time" id="preview-time">--:--</span></div>
							<div class="p-mood" id="preview-mood">#Mood</div>
							<div class="p-comment" id="preview-comment">코멘트를 입력하세요.</div>
							<div class="p-track" id="preview-track">트랙 정보 없음</div>
							<div class="action-bar">
								<button class="icon-btn act like" data-act="like">♡</button>
								<button class="icon-btn act comment" data-act="comment">💬</button>
								<button class="icon-btn act bookmark" data-act="bookmark">🔖</button>
								<button class="icon-btn act share" data-act="share">⤴</button>
							</div>
						</div>
					</div>
				</div>
			</div>
				<!-- Theme Settings Frame -->
			<div class="frame frame-theme" id="frame-theme">
				<h3>테마 커스터마이징</h3>
				<div class="theme-grid" id="theme-grid">
					<div class="theme-card" data-theme="darkNeon"><div class="t-preview darkNeon"></div><div class="t-name">Dark + Neon</div></div>
					<div class="theme-card" data-theme="lightPastel"><div class="t-preview lightPastel"></div><div class="t-name">Light + Pastel</div></div>
					<div class="theme-card" data-theme="neonRetro"><div class="t-preview neonRetro"></div><div class="t-name">Neon Retro</div></div>
					<div class="theme-card" data-theme="minimalBlack"><div class="t-preview minimalBlack"></div><div class="t-name">Minimal Black</div></div>
				</div>
				<button id="apply-theme" class="btn btn-primary-glow" disabled>테마 적용</button>
			</div>
				<!-- Notifications Frame -->
			<div class="frame frame-notifications" id="frame-notifications">
				<h3>알림 센터</h3>
				<ul class="notif-list" id="notif-list"></ul>
			</div>
			</div>
		</section>

	<!-- Floating Notifications Button (mobile / global) -->
	<button id="floating-notif-btn" class="floating-btn" aria-label="알림 보기">🔔</button>
		<script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
		<script src="./config.js"></script>
		<script src="./app.js"></script>
	</body>
	</html>
